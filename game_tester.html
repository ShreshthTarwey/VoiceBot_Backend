<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Game Generator Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Simple keyframe animation for the loader */
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 font-sans">

    <div class="container mx-auto px-4 py-8 max-w-4xl">

        <header class="text-center mb-10">
            <h1 class="text-4xl md:text-5xl font-bold text-blue-600">AI Game Generator ðŸŽ²</h1>
            <p class="mt-2 text-lg text-slate-600">Test the backend API for generating accessible games.</p>
        </header>

        <div class="bg-white p-6 rounded-xl shadow-md mb-6">
            <h2 class="text-2xl font-semibold mb-4">1. Select a Learning Profile</h2>
            <div id="disability-options" class="flex flex-wrap gap-3">
                <button data-disability="visual impairment" class="disability-btn bg-slate-200 hover:bg-blue-500 hover:text-white text-slate-700 font-semibold py-2 px-4 rounded-lg transition-colors">Visual Impairment</button>
                <button data-disability="motor disability" class="disability-btn bg-slate-200 hover:bg-blue-500 hover:text-white text-slate-700 font-semibold py-2 px-4 rounded-lg transition-colors">Motor Disability</button>
                <button data-disability="hearing impairment" class="disability-btn bg-slate-200 hover:bg-blue-500 hover:text-white text-slate-700 font-semibold py-2 px-4 rounded-lg transition-colors">Hearing Impairment</button>
                <button data-disability="learning disability" class="disability-btn bg-slate-200 hover:bg-blue-500 hover:text-white text-slate-700 font-semibold py-2 px-4 rounded-lg transition-colors">Learning Disability</button>
            </div>
            <p id="selection-feedback" class="mt-3 text-sm text-slate-500">No profile selected.</p>
        </div>

        <div class="text-center mb-8">
            <button id="generate-btn" class="bg-blue-600 text-white font-bold text-lg px-8 py-4 rounded-xl shadow-lg hover:bg-blue-700 transition-transform transform hover:scale-105 disabled:bg-slate-400 disabled:cursor-not-allowed disabled:scale-100 flex items-center justify-center mx-auto">
                <span id="btn-text">Generate My Game</span>
                <svg id="loader" class="animate-spin -ml-1 mr-3 h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
        </div>

        <div id="error-message" class="text-center text-red-500 font-semibold mb-6"></div>

        <div class="bg-white rounded-xl shadow-lg">
            <div class="p-4 border-b border-slate-200">
                <h2 class="text-2xl font-semibold">2. Generated Game</h2>
            </div>
            <div id="game-container" class="p-4 min-h-[500px] flex items-center justify-center bg-slate-100 rounded-b-xl">
                <p id="placeholder-text" class="text-slate-500">Your generated game will appear here.</p>
                <iframe id="game-frame" class="w-full h-[500px] border-0 hidden" sandbox="allow-scripts allow-same-origin"></iframe>
            </div>
        </div>
    </div>

    <script>
        // --- DOM Element Selection ---
        const disabilityButtons = document.querySelectorAll('.disability-btn');
        const generateBtn = document.getElementById('generate-btn');
        const selectionFeedback = document.getElementById('selection-feedback');
        const errorMessage = document.getElementById('error-message');
        const gameFrame = document.getElementById('game-frame');
        const placeholderText = document.getElementById('placeholder-text');
        const btnText = document.getElementById('btn-text');
        const loader = document.getElementById('loader');
        
        // This is the URL of your LOCAL Python backend
        const API_URL = 'http://127.0.0.1:5000/generate-game';

        let selectedDisability = '';

        // --- Logic for selecting a disability profile ---
        disabilityButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Reset styles for all buttons
                disabilityButtons.forEach(btn => {
                    btn.classList.remove('bg-blue-600', 'text-white');
                    btn.classList.add('bg-slate-200', 'text-slate-700');
                });

                // Apply active style to the clicked button
                button.classList.add('bg-blue-600', 'text-white');
                button.classList.remove('bg-slate-200', 'text-slate-700');
                
                selectedDisability = button.dataset.disability;
                selectionFeedback.textContent = `Selected: ${selectedDisability}`;
            });
        });

        // --- Logic for the "Generate Game" button ---
        generateBtn.addEventListener('click', async () => {
            if (!selectedDisability) {
                errorMessage.textContent = 'Please select a disability profile first.';
                return;
            }

            // --- UI Updates for Loading State ---
            errorMessage.textContent = '';
            gameFrame.classList.add('hidden'); // Hide any previous game
            placeholderText.textContent = ''; // Clear placeholder text
            placeholderText.classList.remove('hidden');
            loader.classList.remove('hidden');
            btnText.textContent = 'Generating...';
            generateBtn.disabled = true;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ disability: selectedDisability })
                });

                if (!response.ok) {
                    throw new Error(`Server responded with an error: ${response.status}`);
                }

                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                if (data.game_html) {
                    // Success! Display the game in the iframe.
                    gameFrame.srcdoc = data.game_html;
                    gameFrame.classList.remove('hidden');
                    placeholderText.classList.add('hidden');
                } else {
                    throw new Error("API response did not contain game HTML.");
                }

            } catch (err) {
                console.error("Error generating game:", err);
                errorMessage.textContent = `Failed to generate game. Please check if the backend server is running. Details: ${err.message}`;
            } finally {
                // --- Revert UI from Loading State ---
                loader.classList.add('hidden');
                btnText.textContent = 'Generate My Game';
                generateBtn.disabled = false;
                if (!gameFrame.srcdoc) {
                    placeholderText.textContent = 'Your generated game will appear here.';
                }
            }
        });
    </script>
</body>
</html>